<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertor Bon Fiscal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Courier New', Courier, monospace; background-color: #f4f4f4; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .upload-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; width: 100%; max-width: 400px; }
        
        /* Designul Bonului Electronic */
        #receipt-template { 
            background: white; width: 350px; padding: 20px; border: 1px solid #ddd; 
            box-shadow: 0 0 10px rgba(0,0,0,0.05); display: none; margin-top: 20px;
        }
        .header { text-align: center; border-bottom: 2px dashed #000; padding-bottom: 10px; margin-bottom: 15px; }
        .logo { font-size: 24px; font-weight: bold; text-transform: uppercase; }
        .item-row { display: flex; justify-content: space-between; margin: 5px 0; }
        .total { border-top: 2px solid #000; margin-top: 15px; padding-top: 10px; font-weight: bold; font-size: 1.2em; }
        .barcode { margin-top: 20px; text-align: center; font-family: 'Libre Barcode 39', cursive; font-size: 40px; }
        .status { color: #666; font-size: 0.9em; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="upload-section">
        <h2>ÃŽncarcÄƒ Bonul</h2>
        <input type="file" id="imageInput" accept="image/*">
        <p class="status" id="statusText">AÈ™teptare fiÈ™ier...</p>
    </div>

    <div id="receipt-template">
        <div class="header">
            <div class="logo">ðŸ›’ NETTO REPLICAS</div>
            <p id="receipt-date">Data: --.--.----</p>
            <p>FiolstrÃ¦de 5A, ST</p>
        </div>

        <div id="items-container">
            </div>

        <div class="total item-row">
            <span>I ALT (TOTAL)</span>
            <span id="total-price">0.00 DKK</span>
        </div>

        <div class="barcode">
            |||| || | |||| || |||
            <div style="font-size: 12px; font-family: sans-serif;">7793-160126-1-167</div>
        </div>
        <p style="text-align: center; margin-top: 15px;">VÄƒ mulÈ›umim!</p>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const statusText = document.getElementById('statusText');

        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            statusText.innerText = "Se proceseazÄƒ imaginea (OCR)...";
            
            // Folosim Tesseract pentru a citi textul
            Tesseract.recognize(file, 'ron+eng+dan').then(({ data: { text } }) => {
                console.log(text); // Vezi textul extras Ã®n consolÄƒ
                processText(text);
                generatePDF();
            });
        });

        function processText(text) {
            const lines = text.split('\n');
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            
            // Logica simplificatÄƒ de cÄƒutare preÈ›uri È™i produse
            lines.forEach(line => {
                if (line.match(/\d+,\d{2}/)) { // CautÄƒ linii cu format preÈ› (ex: 19,97)
                    const parts = line.split(/\s{2,}/);
                    if (parts.length >= 2) {
                        const row = document.createElement('div');
                        row.className = 'item-row';
                        row.innerHTML = `<span>${parts[0]}</span><span>${parts[1]}</span>`;
                        container.appendChild(row);
                    }
                }
                
                // CautÄƒ Totalul
                if (line.toLowerCase().includes('alt') || line.toLowerCase().includes('total')) {
                    const totalMatch = line.match(/\d+,\d{2}/);
                    if (totalMatch) document.getElementById('total-price').innerText = totalMatch[0] + " DKK";
                }
            });

            document.getElementById('receipt-template').style.display = 'block';
            statusText.innerText = "Bon generat! Se descarcÄƒ PDF...";
        }

        function generatePDF() {
            const element = document.getElementById('receipt-template');
            const opt = {
                margin:       0.5,
                filename:     'bon_electronic.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2 },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                statusText.innerText = "Finalizat!";
            });
        }
    </script>
</body>
</html>
